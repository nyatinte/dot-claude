---
allowed-tools: Bash(git diff:*), Bash(git diff --staged:*), Bash(git show:*), Bash(git log:*), Read(*), Write(review.md), Glob(**/*), Grep
denied-tools: Bash(git push:*), Bash(git commit:*), Edit(*), MultiEdit(*)
description: 現在の変更に対して包括的なコードレビューを実行
---

## コンテキスト

- 現在のブランチ: `!git branch --show-current`
- Gitステータス: `!git status --short`
- ultrathink

## あなたのタスク

現在の変更に対して徹底的なコードレビューを実行し、詳細なレビューレポートを生成する。

### 1. **レビュー対象の変更を特定**:

差分を特定する優先順位:
1. $ARGUMENTSからのユーザー指示
2. Git差分（ステージングされていない変更）: `git diff`
3. ステージングされた変更: `git diff --staged`
4. 最新のコミット: `git show HEAD`

### 2. **レビュー基準**:

以下のレビュー観点を順番に適用:

#### 主要基準:
- **リポジトリガイドライン**: このリポジトリのコーディングガイドライン（CLAUDE.md、.editorconfig、リンティングルール）への準拠を確認

#### 一般的なプログラミング原則:
- **SOLID原則**: 単一責任、開放閉鎖、リスコフの置換、インターフェース分離、依存性逆転
- **DRY（Don't Repeat Yourself）**: コードの重複を避ける
- **KISS（Keep It Simple, Stupid）**: 複雑さより単純さを優先
- **YAGNI（You Aren't Gonna Need It）**: 不要な機能を追加しない
- **クリーンコード原則**: 意味のある名前、小さな関数、適切な抽象化
- **コードの可読性**: 明確な構造、一貫したフォーマット、自己文書化されたコード

### 3. **レビューアプローチ**:

- 客観的かつ建設的に批判的であること
- 実行可能な改善に焦点を当てる
- 影響と重要度で問題を優先順位付け

### 4. **レビューレポートの生成**:

以下の構造で`review.md`を作成:

```markdown
# コードレビューレポート

## 総括
[変更の全体的な評価、主な強みと改善領域を強調]

## 対応すべき事項

### 問題 #1: [問題タイトル]
- **概要**: [問題の簡潔な説明]
- **優先度**: クリティカル | 高 | 中 | 低
- **なぜ**: [なぜこれが問題なのかの説明]
- **どのように修正するか**: [該当する場合はコード例を含む具体的な技術的解決策]
- **エージェントプロンプト**: 
  ```
  [ファイル:行番号]の[具体的な問題]を修正してください。
  現在の実装: [現在のコード]
  変更後: [提案する実装]
  理由: [簡潔な説明]
  ```

### 問題 #2: [各問題について続ける...]

## 良い点
[良い実践と適切に実装された機能を強調]

## 推奨事項
[将来の改善のための一般的な提案]
```

### 5. **優先度レベル**:

- **クリティカル**: 破壊的変更、セキュリティ問題、データ損失リスク
- **高**: 重大なバグ、パフォーマンス問題、コア原則の違反
- **中**: コード品質の問題、保守性の懸念
- **低**: スタイルの不一致、軽微な最適化

## ユーザー追加指示

$ARGUMENTS